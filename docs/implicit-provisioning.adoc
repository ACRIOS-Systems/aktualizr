# Implicit Provisioning

This document describes the current support for implicit provisioning in Aktualizr and meta-updater.

## Background

In automatic provisioning, bootstrap credentials are downloaded and installed on devices to initiate the provisioning process. In implicit provisioning, devices are to be pre-loaded with the requisite provisioning credentials.

## Configuration

The following items are relevant for implicit provisioning:

[options=header]
|===================
| Configuration option | Where it will come from
| Server URL | Written into `sota.toml` during bitbake via `implicit_writer`
| Root CA cert | Installed to `/usr/lib/sota/root.crt` during bitbake via `implicit_writer`
| TLS key/cert | Pre-installed or manually installed, e.g. with `cert_provider`
| Device ID | Read from Common Name field of TLS cert
| Uptane public/private key | Automatically generated by Aktualizr
| Uptane primary serial number | Automatically generated by Aktualizr
| Primary ECU Hardware ID | Automatically generated by Aktualizr
|===================

An example `.toml` configuration file can be found at `config/sota_implicit_prov.toml`. This is what is used as in input to `implicit_writer` during bitbaking with meta-updater.

## Steps

1. In meta-updater, set `SOTA_CLIENT_PROV = "aktualizr-implicit-prov"`. Currently, you will also need to set `SOTA_PACKED_CREDENTIALS` to provisioning credentials zip file.
1. Build a standard image using bitbake.
1. Boot the image.
1. Optionally, verify that Aktualizr is not provisioning and that the device is not visible in the Garage.
1. Load credentials onto the device, for example with `cert_provider` from the Aktualizr repo: `cert_provider -c credentials.zip -t <device> -d /var/sota`
1. Verify that Aktualizr provisions correctly with the server using the expected Device ID.
