= Automatic Provisioning

This document describes the current support for automatic provisioning in Aktualizr and meta-updater using mutual TLS authentication with SSL client certificates.

== Overview

The process works as follows:

1. The user downloads a package that contains an initial provisioning key. This is installed on all devices and is only used to bootstrap the provisioning process.
2. When Aktualizr first runs on a device, it uses this key/certificate to make a request to the device gateway https API.  The server registers the new device and returns a PKCS#12 archive containing the real credentials for the device.
3. The device unpacks the root CA certificate and client certificate from this bundle into the paths specified in the `[storage]` section of the config.
3. The device uses this private key/certificate for all further communication with the server.

## Configuration

The following items are relevant for automatic provisioning:

[options=header]
|===================
| Configuration option | Where it will come from
| Server URL | Read from credentials archive
| TLS key/cert/root CA | Read from credentials archive
| Device ID | Automatically generated by Aktualizr
| Uptane public/private key | Automatically generated by Aktualizr
| Uptane primary serial number | Automatically generated by Aktualizr
| Primary ECU Hardware ID | Automatically generated by Aktualizr
|===================

An example `.toml` configuration file can be found at `config/sota_autoprov.toml`. This is what is used by the `aktualizr-auto-prov` recipe in meta-updater.
